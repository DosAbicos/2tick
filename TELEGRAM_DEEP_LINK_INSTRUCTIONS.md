# ‚úÖ Telegram Deep Link –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è - –ì–æ—Ç–æ–≤–æ!

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 1Ô∏è‚É£ –ù–∞–Ω–∏–º–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏
- –í–∏–¥–∏—Ç —Ç—Ä–∏ –∫–Ω–æ–ø–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:
  - üì± SMS –∫–æ–¥ (6 —Ü–∏—Ñ—Ä)
  - ‚òéÔ∏è –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ (4 —Ü–∏—Ñ—Ä—ã)  
  - üí¨ **–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –≤ Telegram** ‚Üê –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê

### 2Ô∏è‚É£ –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –≤ Telegram"
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–∞—Ç —Å –±–æ—Ç–æ–º @twotick_bot
- –ë–æ—Ç —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
- –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è:
```
üîê Signify KZ - –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

–í–∞—à –∫–æ–¥ –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞:
123456

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

‚ö†Ô∏è –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 10 –º–∏–Ω—É—Ç.
```

### 3Ô∏è‚É£ –ö–æ–ø–∏—Ä—É–µ—Ç –∫–æ–¥ –∏–∑ Telegram
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç (–≤–∫–ª–∞–¥–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π)
- –í–≤–æ–¥–∏—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–π 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
- –ù–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"

### 4Ô∏è‚É£ –î–æ–≥–æ–≤–æ—Ä –ø–æ–¥–ø–∏—Å–∞–Ω! ‚úÖ

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Backend API

**1. –ü–æ–ª—É—á–µ–Ω–∏–µ Telegram Deep Link:**
```bash
GET /api/sign/{contract_id}/telegram-deep-link
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "deep_link": "https://t.me/twotick_bot?start=signly",
  "bot_username": "twotick_bot",
  "contract_id": "550e8400-e29b-41d4-a716-446655440000"
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è 6-–∑–Ω–∞—á–Ω—ã–π OTP –∫–æ–¥
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `verifications`:
```json
{
  "contract_id": "550e8400-e29b-41d4-a716-446655440000",
  "otp_code": "123456",
  "method": "telegram",
  "created_at": "2025-10-21T18:00:00Z",
  "expires_at": "2025-10-21T18:10:00Z",
  "verified": false
}
```
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è deep link —Å contract_id –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ

**2. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è OTP –∫–æ–¥–∞:**
```bash
POST /api/sign/{contract_id}/verify-telegram-otp
Content-Type: application/json

{
  "code": "123456"
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "verified": true,
  "signature_hash": "A1B2C3D4E5F6G7H8",
  "message": "–ü–æ–¥–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞"
}
```

### Telegram Bot

**–û–±—Ä–∞–±–æ—Ç–∫–∞ Deep Link:**

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É `https://t.me/twotick_bot?start={contract_id}`:

1. –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É `/start {contract_id}`
2. –ò—â–µ—Ç –≤ –ë–î –∑–∞–ø–∏—Å—å verification —Å —ç—Ç–∏–º contract_id
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç OTP –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
4. –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 10 –º–∏–Ω—É—Ç

**–ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –≤ –±–æ—Ç–µ:**
```python
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    # –ü–æ–ª—É—á–∞–µ–º contract_id –∏–∑ deep link
    if context.args and len(context.args) > 0:
        contract_id = context.args[0]
        
        # –ò—â–µ–º OTP –≤ –ë–î
        verification = await db.verifications.find_one({
            "contract_id": contract_id,
            "method": "telegram",
            "verified": False
        })
        
        if verification:
            otp_code = verification['otp_code']
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥
            await update.message.reply_text(
                f"üîê Signify KZ - –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\n\n"
                f"–í–∞—à –∫–æ–¥ –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞:\n"
                f"`{otp_code}`\n\n"
                f"–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.\n\n"
                f"‚ö†Ô∏è –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 10 –º–∏–Ω—É—Ç.",
                parse_mode='Markdown'
            )
```

### Frontend

**–ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è Telegram:**
```javascript
<Button
  onClick={async () => {
    try {
      // –ü–æ–ª—É—á–∞–µ–º deep link —Å –±—ç–∫–µ–Ω–¥–∞
      const response = await axios.get(`${API}/sign/${id}/telegram-deep-link`);
      const deepLink = response.data.deep_link;
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º Telegram
      window.open(deepLink, '_blank');
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞ –∫–æ–¥–∞
      setVerificationMethod('telegram');
      setTelegramCooldown(60);
      
      toast.success('–û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥');
    } catch (error) {
      toast.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Telegram');
    }
  }}
  className="w-full bg-[#0088cc] hover:bg-[#0077b3] text-white"
>
  üí¨ –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –≤ Telegram
</Button>
```

**–§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ –∫–æ–¥–∞:**
```javascript
<input
  type="text"
  maxLength={6}
  value={telegramCode}
  onChange={(e) => setTelegramCode(e.target.value.replace(/\D/g, ''))}
  className="w-full px-4 py-3 text-center text-2xl tracking-widest border rounded-lg"
  placeholder="_ _ _ _ _ _"
  autoFocus
/>
```

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### ‚úÖ –°—Ç–∞—Ä–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (–†–ï–®–ï–ù–ê):
- ‚ùå –ù—É–∂–Ω–æ –±—ã–ª–æ –≤–≤–æ–¥–∏—Ç—å Telegram username
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã–ª —Å–∞–º –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É /start
- ‚ùå –ö–æ–¥ –∏–Ω–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å chat_id

### ‚úÖ –ù–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
- ‚úÖ **–û–¥–∏–Ω –∫–ª–∏–∫** - –∫–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **–ù–µ –Ω—É–∂–Ω–æ –≤–≤–æ–¥–∏—Ç—å username** - –≤—Å—ë —á–µ—Ä–µ–∑ deep link
- ‚úÖ **–ö–æ–¥ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É** - –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –±–æ—Ç–∞
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ–π UX** - –æ—Ç–∫—Ä—ã–ª ‚Üí —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª ‚Üí –≤—Å—Ç–∞–≤–∏–ª ‚Üí –≥–æ—Ç–æ–≤–æ

---

## –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω:
```bash
tail -f /tmp/telegram_bot.log
```

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç:
```bash
pkill -f start_telegram_bot.py
cd /app/backend
python3 start_telegram_bot.py > /tmp/telegram_bot.log 2>&1 &
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ backend:
```bash
tail -f /var/log/supervisor/backend.err.log
```

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ curl:
```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å deep link
curl -X GET https://signlify.preview.emergentagent.com/api/sign/CONTRACT_ID/telegram-deep-link

# 2. –û—Ç–∫—Ä—ã—Ç—å deep link –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ Telegram
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫–æ–¥

# 3. –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
curl -X POST https://signlify.preview.emergentagent.com/api/sign/CONTRACT_ID/verify-telegram-otp \
  -H "Content-Type: application/json" \
  -d '{"code": "123456"}'
```

---

## –°—Ç–∞—Ç—É—Å

‚úÖ **Backend API** - —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ **Telegram Bot** - –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ **Frontend UI** - –∫–Ω–æ–ø–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞  
‚úÖ **Deep Link** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ **OTP Verification** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã  

**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ
