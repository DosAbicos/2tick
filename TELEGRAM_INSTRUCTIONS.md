# Telegram –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ù–∞–Ω–∏–º–∞—Ç–µ–ª–µ–π)

### –®–∞–≥ 1: –ê–∫—Ç–∏–≤–∞—Ü–∏—è –±–æ—Ç–∞ (–æ–¥–∏–Ω —Ä–∞–∑)
1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞: **@twotick_bot**
3. –ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É: `/start`
4. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

### –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–∞
1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è –≤—ã–±–µ—Ä–∏—Ç–µ "üí¨ Telegram"
2. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram username **–±–µ–∑ —Å–∏–º–≤–æ–ª–∞ @**
   - –ù–∞–ø—Ä–∏–º–µ—Ä: `ngzadl` (–Ω–µ `@ngzadl`)
3. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –≤ Telegram"
4. –ü–æ–ª—É—á–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –≤ Telegram
5. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–∞–π—Ç–µ
6. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"

‚úÖ –î–æ–≥–æ–≤–æ—Ä –ø–æ–¥–ø–∏—Å–∞–Ω!

---

## –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞

–ë–æ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:

```bash
cd /app/backend
python3 start_telegram_bot.py > /tmp/telegram_bot.log 2>&1 &
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞

```bash
tail -f /tmp/telegram_bot.log
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (.env)

```bash
TELEGRAM_BOT_TOKEN="8456754827:AAEH3VcXZy1-eFfRgWoiT1QXKdeaTdz75Hc"
TELEGRAM_BOT_USERNAME="twotick_bot"
```

### Fallback —Ä–µ–∂–∏–º

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –≤ mock —Ä–µ–∂–∏–º –µ—Å–ª–∏:
- –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–ø–∏—Å–∞–ª –±–æ—Ç—É /start
- Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –û—à–∏–±–∫–∞ "Chat not found"

–í mock —Ä–µ–∂–∏–º–µ –∫–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### API Endpoints

**–ó–∞–ø—Ä–æ—Å –∫–æ–¥–∞:**
```bash
POST /api/sign/{contract_id}/request-telegram-otp
Content-Type: application/json

{
  "telegram_username": "ngzadl"
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "message": "–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram @ngzadl",
  "telegram_username": "ngzadl",
  "mock_otp": "123456"  // —Ç–æ–ª—å–∫–æ –≤ fallback —Ä–µ–∂–∏–º–µ
}
```

**–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞:**
```bash
POST /api/sign/{contract_id}/verify-telegram-otp
Content-Type: application/json

{
  "code": "123456"
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "verified": true,
  "signature_hash": "A1B2C3D4E5F6G7H8",
  "message": "–ü–æ–¥–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞"
}
```

### –•—Ä–∞–Ω–µ–Ω–∏–µ chat_ids

–ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç chat_id –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ `/tmp/telegram_chat_ids.json`:

```json
{
  "ngzadl": 123456789,
  "user2": 987654321
}
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –ø–æ chat_id, –º–∏–Ω—É—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è username.

### –õ–æ–≥–∏

- **Backend:** `/var/log/supervisor/backend.err.log`
- **Telegram Bot:** `/tmp/telegram_bot.log`

---

## –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

‚úÖ SMS –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (Twilio fallback)
‚úÖ Call –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (mock –∫–æ–¥ 1334)
‚úÖ Telegram –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (—Å fallback)
‚úÖ PDF –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚úÖ PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤
‚úÖ –í—Å–µ —Ç—Ä–∏ –∫–Ω–æ–ø–∫–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
‚úÖ –ö—É–ª–¥–∞—É–Ω—ã 60 —Å–µ–∫—É–Ω–¥

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚ö†Ô∏è Telegram username –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ë–ï–ó @
‚ö†Ô∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É /start
‚ö†Ô∏è –í fallback —Ä–µ–∂–∏–º–µ –∫–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ
‚ö†Ô∏è Call OTP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–∏–Ω –Ω–æ–º–µ—Ä Twilio (—Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Proxy)
